- name: WP-CLIをセットアップする
  import_tasks: wp-cli.yml

- name: 本番環境を作成する
  import_tasks: setup.yml
  vars:
    working_directory: "{{ production_directory }}"
    site_db_name: "{{ production_db_name }}"
    site_db_prefix: "{{ production_db_prefix }}"
    site_url: "{{ production_url }}"
    site_title: "{{ production_title }}"
    site_admin_name: "{{ production_admin_name }}"
    site_admin_pass: "{{ production_admin_pass }}"
    site_admin_mail: "{{ production_admin_mail }}"
    site_plugins: "{{ production_plugins }}"
    extra_php: "define( 'DISALLOW_FILE_EDIT',true );"

- name: ステージング環境を作成する
  import_tasks: setup.yml
  vars:
    working_directory: "{{ staging_directory }}"
    site_db_name: "{{ staging_db_name }}"
    site_db_prefix: "{{ staging_db_prefix }}"
    site_url: "{{ staging_url }}"
    site_title: "{{ staging_title }}"
    site_admin_name: "{{ staging_admin_name }}"
    site_admin_pass: "{{ staging_admin_pass }}"
    site_admin_mail: "{{ staging_admin_mail }}"
    site_plugins: "{{ staging_plugins }}"
    extra_php: |
      define( 'WP_DEBUG', true );
      define( 'WP_DEBUG_LOG', true );
      define( 'DISALLOW_FILE_EDIT',true );
  when: staging_necessary

- name: テストデータをステージング環境に導入する
  import_tasks: import_test_data.yml
  vars:
    working_directory: "{{ staging_directory }}"
  when: staging_test_data

- name: バックアップスクリプトをインストール、設定する
  import_tasks: backup.yml
  vars:
    working_directories:
      - "{{ production_directory }}"
      - "{{ staging_directory }}"

- name: アップデートスクリプトをインストール、設定する
  import_tasks: update.yml
  vars:
    working_directories:
      - "{{ production_directory }}"
      - "{{ staging_directory }}"
